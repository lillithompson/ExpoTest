#!/usr/bin/env node
/* eslint-disable no-console */

const fs = require('fs');
const path = require('path');

const root = process.cwd();
const samplesDir = path.join(root, 'assets', 'samples');
const outputPath = path.join(root, 'utils', 'sample-assets-content.ts');

const dirs = [
  { name: 'files', exportName: 'SAMPLE_FILE_CONTENTS' },
  { name: 'patterns', exportName: 'SAMPLE_PATTERN_CONTENTS' },
  { name: 'tilesets', exportName: 'SAMPLE_TILESET_CONTENTS' },
];

const lines = [
  '/**',
  ' * Embedded sample asset contents. Generated by scripts/embed-sample-assets.js',
  ' * Do not edit by hand. After updating files in assets/samples/, run: npm run embed-samples',
  ' */',
  '',
];

for (const { name, exportName } of dirs) {
  const dirPath = path.join(samplesDir, name);
  if (!fs.existsSync(dirPath)) {
    lines.push(`export const ${exportName}: string[] = [];`);
    lines.push('');
    continue;
  }
  const files = fs
    .readdirSync(dirPath, { withFileTypes: true })
    .filter((e) => e.isFile())
    .map((e) => e.name)
    .sort();
  const contents = files.map((f) => {
    const content = fs.readFileSync(path.join(dirPath, f), 'utf8');
    return content;
  });
  lines.push(`export const ${exportName}: string[] = ${JSON.stringify(contents)};`);
  lines.push('');
}

fs.writeFileSync(outputPath, lines.join('\n'), 'utf8');
console.log('Wrote', outputPath);
